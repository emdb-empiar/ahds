

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ahds.header &mdash; ahds 0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> ahds
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../overview.html"><code class="docutils literal notranslate"><span class="pre">ahds</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ahds.html"><code class="docutils literal notranslate"><span class="pre">ahds</span></code> package</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">ahds</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../ahds.html">ahds</a> &raquo;</li>
        
      <li>ahds.header</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for ahds.header</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># header.py</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Module to convert parsed data from an Amira (R) header into a set of nested objects. The key class is :py:class:`ahds.header.AmiraHeader`.</span>

<span class="sd">Usage:</span>

<span class="sd">::</span>

<span class="sd">    &gt;&gt;&gt; from ahds.header import AmiraHeader</span>
<span class="sd">    &gt;&gt;&gt; ah = AmiraHeader.from_file(&#39;&lt;somfile&gt;.am&#39;)</span>
<span class="sd">    &gt;&gt;&gt; print ah</span>

<span class="sd">Each nested object is constructed from the :py:class:``Block`` class defined.</span>

<span class="sd">There are fife top-level attributes that every ``AmiraHeader`` will have:</span>

<span class="sd">*    designation</span>

<span class="sd">*    definitions</span>

<span class="sd">*    parameters</span>

<span class="sd">*    materials</span>

<span class="sd">*    data_pointers</span>

<span class="sd">All of them, exempt materials and parameters are marked deprecated and may be removed in</span>
<span class="sd">future. The designation and defintions attributes just return the reference to the AmiraHeader</span>
<span class="sd">instance which host all the attributes and data array declarations (definitions) found within</span>
<span class="sd">the AmiraMesh and HyperSurface files. The data_pointers attribute collects from each</span>
<span class="sd">attribute representing a valid array declaration the defined data definitions and returns the resulting</span>
<span class="sd">list. New code should directly access the Block objects describing the available data directly</span>
<span class="sd">from the corresponding array attribute of the AmiraHeader object. </span>

<span class="sd">The blocks defining the available data structures extend the basic Block to the corresponding </span>
<span class="sd">AmiraMeshDataStream and AmiraHxSurfaceDataStream blocks which allow to load and access the correspinding</span>
<span class="sd">data using the data property defined by theses blocks. The additional stream_data, encoded_data and</span>
<span class="sd">decoded_data attributes are deprecated and may be removed in future versions.</span>

<span class="sd">The attrs attribute of all Blocks and extended Block objects including AmiraHeader it self</span>
<span class="sd">which allows to query the attributes added during loading is deprecated and may be removed in future version.</span>
<span class="sd">To query which attributes are defined on each block use the builtin dir function instead. To </span>
<span class="sd">access the defined attributes just use them liá¸±e any other static attribute.</span>

<span class="sd">The following attributes are moved from the designation attribute to the basic header block:</span>
<span class="sd">        </span>
<span class="sd">        *    filetype e.g. ``AmiraMesh`` or ``HyperSurface``</span>
<span class="sd">        *    dimensions e.g. ``3D``</span>
<span class="sd">        *    format e.g. ``BINARY-LITTLE-ENDIAN``</span>
<span class="sd">        *    version e.g. ``2.1``</span>
<span class="sd">        *    extra_format (if present)</span>
<span class="sd">        </span>
<span class="sd">:: </span>

<span class="sd">    &gt;&gt;&gt; print(ah.Nodes)</span>
<span class="sd">    print(ah.Nodes)</span>
<span class="sd">     +-Nodes: (&lt;ahds.ahds_common.Block object at 0x7f5dc1a74d08&gt;)</span>
<span class="sd">     |  |  +-Coordinates: (&lt;ahds.data_stream.AmiraMeshDataStream object at 0x7f5dc1a97458&gt;)</span>
<span class="sd">     |  |  |  +-block: 1</span>
<span class="sd">     |  |  |  +-array: Nodes(&lt;ahds.ahds_common.Block object at 0x7f5dc1a74d08&gt;)</span>
<span class="sd">     |  |  |  +-type: float</span>
<span class="sd">     |  |  |  +-dimension: 3</span>
<span class="sd">     |  +-dimension: 3154</span>
<span class="sd">    &gt;&gt;&gt; print(ah.Tetrahedra.Nodes)</span>
<span class="sd">     +-Nodes: (&lt;ahds.data_stream.AmiraMeshDataStream object at 0x7ffa3da25180&gt;)</span>
<span class="sd">     |  +-type: int</span>
<span class="sd">     |  +-dimension: 4</span>
<span class="sd">     |  +-array: Tetrahedra(&lt;ahds.ahds_common.Block object at 0x7ffa3da3a9c8&gt;)</span>
<span class="sd">     |  |  |  +-Materials: (&lt;ahds.data_stream.AmiraMeshDataStream object at 0x7ffa3da25118&gt;)</span>
<span class="sd">     |  |  |  |  +-type: byte</span>
<span class="sd">     |  |  |  |  +-dimension: 1</span>
<span class="sd">     |  |  |  |  +-array: Tetrahedra(&lt;ahds.ahds_common.Block object at 0x7ffa3da3a9c8&gt;)</span>
<span class="sd">     |  |  |  |  +-block: 4</span>
<span class="sd">     |  |  +-Nodes: (&lt;ahds.data_stream.AmiraMeshDataStream object at 0x7ffa3da25180&gt;)</span>
<span class="sd">     |  |  +-dimension: 14488</span>
<span class="sd">     |  +-block: 3</span>


<span class="sd">The special array attribute indicates that the corresponding block is linked to a specific data array.</span>
<span class="sd">In the above examples to the Nodes structure defining the 3D coordenates of the corners of the Tetrahedra</span>
<span class="sd">and the Tetrahedra structure defining which nodes belong to which tetrahedron.</span>
<span class="sd">In the frist example only the block header is repeated to indicate the backreference in the second</span>
<span class="sd">example the full information is displayed for the parent array.</span>

<span class="sd">The dimensions attributes indicate the number of nodes on which the corresponding data is defined and the</span>
<span class="sd">dimension of the Coordinates block defines how many elements each entry has. By calling</span>

<span class="sd">    &gt;&gt;&gt; print(ah.Nodes.Coordinates.data.shape)</span>
<span class="sd">    (3154, 3)</span>

<span class="sd">the corresponding data block is loaded and converted into a numpy array having the exact shape as</span>
<span class="sd">indicated by the two dimension attributes. The number of rows corresponds to the the dimension </span>
<span class="sd">attribute of the Nodes Block and the number of columns is equal to the dimensions attribute.</span>

<span class="sd">    &gt;&gt;&gt; ah.Nodes.Coordinates.data[:5,:]</span>
<span class="sd">    array([[ 0.09844301, -0.007811  , -0.0869359 ],</span>
<span class="sd">           [ 0.055759  ,  0.02217599,  0.093963  ],</span>
<span class="sd">           [ 0.1167009 ,  0.03151399, -0.0842569 ],</span>
<span class="sd">           [ 0.11912691,  0.03461899, -0.046145  ],</span>
<span class="sd">           [ 0.11671901,  0.028787  , -0.0340129 ]], dtype=float32)</span>

<span class="sd">The datatype of the array corresponds to the one indicated by the type attribute. The endianess of the</span>
<span class="sd">file is transparently handled during the loading of the data.</span>


<span class="sd">    &gt;&gt;&gt; print ah.data_pointers.data_pointer_1</span>
<span class="sd">    data_pointer_1</span>
<span class="sd">    pointer_name: VERTEX</span>
<span class="sd">    data_format: None</span>
<span class="sd">    data_dimension: 3</span>
<span class="sd">    data_type: float</span>
<span class="sd">    data_name: VertexCoordinates</span>
<span class="sd">    data_index: 1</span>
<span class="sd">    data_length: None</span>

<span class="sd">Data pointers are identified by the name ``data_pointer_&lt;n&gt;`` where &lt;n&gt; is the number indicated by the</span>
<span class="sd">block attibute in the above examples.</span>

<span class="sd">The above approach can also be used to load Amira HyperSurface files.</span>

<span class="sd">    &gt;&gt;&gt; ah = AmiraHeader.from_file(&#39;&lt;somfile&gt;.surf&#39;)</span>

<span class="sd">The restulting structure and behavior is the same as for AmiraMesh files.</span>

<span class="sd">    &gt;&gt;&gt; print(ah)</span>
<span class="sd">    AMIRA HEADER (&lt;somfile&gt;.surf)</span>
<span class="sd">     +-path: &lt;somepath&gt;</span>
<span class="sd">     +-data section at: 355</span>
<span class="sd">    --------------------------------------------------</span>
<span class="sd">     +-parameters: (&lt;ahds_common.Block object at 0x7efd1cc9ed48&gt;)</span>
<span class="sd">     |  |  +-Materials: (&lt;ahds_common.ListBlock object at 0x7efd1cfcc8b8&gt;)</span>
<span class="sd">     |  |  |  +-Exterior2: []</span>
<span class="sd">     |  |  |  +-Exterior: (&lt;ahds_common.Block object at 0x7efd1cfd5108&gt;)</span>
<span class="sd">     |  |  |  |  +-Id: 1</span>
<span class="sd">     |  |  |  +-RA: (&lt;ahds_common.Block object at 0x7efd1cfd5088&gt;)</span>
<span class="sd">     |  |  |  |  +-Id: 2</span>
<span class="sd">     |  |  |  |  +-Color: [0.94902, 0.847059, 0.0901961]</span>
<span class="sd">     |  |  +-[0]=None</span>
<span class="sd">     |  |  +-[1]=(Exterior&lt;ahds_common.Block object at 0x7efd1cfd5108&gt;)</span>
<span class="sd">     |  |  +-[2]=(RA&lt;ahds_common.Block object at 0x7efd1cfd5088&gt;)</span>
<span class="sd">     |  |  +-length: 3</span>
<span class="sd">     |  +-BoundaryIds: &quot;BoundaryConditions&quot;(&lt;ahds_common.Block object at 0x7efd1cfd5608&gt;)</span>
<span class="sd">     |  |  |  +-IdList: (&lt;ahds_common.ListBlock object at 0x7efd1cfcc870&gt;)</span>
<span class="sd">     |  |  |  +-[0]=(Id0&lt;ahds_common.Block object at 0x7efd1cc9e048&gt;)</span>
<span class="sd">     |  |  |  +-length: 1</span>
<span class="sd">     |  |  |  +-Id0: (&lt;ahds_common.Block object at 0x7efd1cc9e048&gt;)</span>
<span class="sd">     |  |  |  |  +-Id: 0</span>
<span class="sd">     |  |  |  |  +-Info: &quot;undefined&quot;</span>
<span class="sd">    --------------------------------------------------</span>
<span class="sd">     +-RBloodAtrium.surf: (&lt;__main__.AmiraHeader object at 0x7efd1cfb7b10&gt;)</span>
<span class="sd">     |  +-extra_format: None</span>
<span class="sd">     |  +-filetype: HyperSurface</span>
<span class="sd">     |  +-version: 0.1</span>
<span class="sd">     |  +-dimension: None</span>
<span class="sd">     |  +-format: BINARY</span>

<span class="sd">Any HyperSurface file implicitly defines the following basic elements.</span>

<span class="sd">    * Parameters</span>
<span class="sd">    * Vertices</span>
<span class="sd">    * Patch&lt;n&gt;</span>
<span class="sd">    * PatchList</span>

<span class="sd">As there can be more than one Patch within the a HyperSuface file, for each additional Patch a</span>
<span class="sd">Patch&lt;n&gt; block is insereted into the header on accessing the corresponding data. The</span>
<span class="sd">PatcheList attribute allows to access all defined patches in their order as they are defined within</span>
<span class="sd">the file. Additionally the following attributes may be present and added when accessing them.</span>

<span class="sd">    * Surface&lt;n&gt;</span>
<span class="sd">    * SurfaceList</span>
<span class="sd">    * BoundaryCurve&lt;n&gt;</span>
<span class="sd">    * BoundaryCurveList</span>
<span class="sd">    * NBranchingPoints</span>
<span class="sd">    * NVerticesOnCurves</span>

<span class="sd">The Vertices contains the follwoing datastream</span>
<span class="sd">    * Coordinates</span>

<span class="sd">The Patch&lt;n&gt; contains the follwoing datastreams and attributes</span>
<span class="sd">    * InnerRegion</span>
<span class="sd">    * OuterRegion</span>
<span class="sd">    * BranchingPoints</span>
<span class="sd">    * Triangles</span>

<span class="sd">The Surface&lt;n&gt; contains the following datastream and attributes</span>
<span class="sd">    * Region</span>
<span class="sd">    * Patches</span>

<span class="sd">The BoundaryCurve&lt;n&gt; defindes teh followng data stream</span>
<span class="sd">    * Vertices</span>

<span class="sd">The NBranchingPoints and NVerticesOnCurves are repesented by value attributes of</span>
<span class="sd">the AmiraHeader Block.</span>


<span class="sd">NOTE!!!</span>
<span class="sd">NEW DESCRIPTION OF THE FILE FORMAT:</span>
<span class="sd">https://assets.thermofisher.com/TFS-Assets/MSD/Product-Guides/user-guide-amira-software.pdf</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">.core</span> <span class="k">import</span> <span class="n">Block</span><span class="p">,</span> <span class="n">deprecated</span><span class="p">,</span> <span class="n">ListBlock</span>
<span class="kn">from</span> <span class="nn">.data_stream</span> <span class="k">import</span> <span class="n">set_data_stream</span>
<span class="kn">from</span> <span class="nn">.grammar</span> <span class="k">import</span> <span class="n">get_parsed_data</span>


<div class="viewcode-block" id="AmiraHeader"><a class="viewcode-back" href="../../ahds.html#ahds.AmiraHeader">[docs]</a><span class="k">class</span> <span class="nc">AmiraHeader</span><span class="p">(</span><span class="n">Block</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class to encapsulate Amira metadata and accessors to amria data streams&quot;&quot;&quot;</span>

    <span class="c1"># __slots__ field is used to separate internal attributes from the dynamic attributes</span>
    <span class="c1"># representing the metadata and the accessors to the content of the data streams</span>
    <span class="c1"># which will be stored inside the __dict__ attribute of the Block base class</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s1">&#39;_fn&#39;</span><span class="p">,</span> <span class="s1">&#39;_parsed_data&#39;</span><span class="p">,</span> <span class="s1">&#39;_header_length&#39;</span><span class="p">,</span> <span class="s1">&#39;_file_format&#39;</span><span class="p">,</span> <span class="s1">&#39;_parameters&#39;</span><span class="p">,</span> <span class="s1">&#39;_load_streams&#39;</span><span class="p">,</span>
        <span class="s1">&#39;_data_stream_count&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">load_streams</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Construct an AmiraHeader object from parsed data&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fn</span> <span class="o">=</span> <span class="n">fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_literal_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parsed_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_header_length</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_format</span> <span class="o">=</span> <span class="n">get_parsed_data</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span>
                                                                                                        <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># load the streams</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load_streams</span> <span class="o">=</span> <span class="n">load_streams</span>
        <span class="c1"># data stream count</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_stream_count</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># super(AmiraHeader, self).__init__(fn)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">AmiraHeader</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s1">&#39;header&#39;</span><span class="p">)</span>
        <span class="c1"># load the parse data into this object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load</span><span class="p">()</span>

<div class="viewcode-block" id="AmiraHeader.from_file"><a class="viewcode-back" href="../../ahds.html#ahds.AmiraHeader.from_file">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="nd">@deprecated</span><span class="p">(</span><span class="s2">&quot;Now you can directly create a header from the file name as AmiraHeader(&#39;file.am&#39;)&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">from_file</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Deprecated classmethod&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">filename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fn</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">literal_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_literal_data</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">parsed_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parsed_data</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">load_streams</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_streams</span>

    <span class="nd">@load_streams</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">load_streams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;must be a bool&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load_streams</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data_stream_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_stream_count</span>

<div class="viewcode-block" id="AmiraHeader.load"><a class="viewcode-back" href="../../ahds.html#ahds.AmiraHeader.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Public loading method&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_header_length</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">flatten_dict</span><span class="p">(</span><span class="n">in_dict</span><span class="p">):</span>
        <span class="n">block_data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">in_dict</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">block_keys0</span> <span class="ow">in</span> <span class="n">block</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">block_data</span><span class="p">[</span><span class="n">block_keys0</span><span class="p">]</span> <span class="o">=</span> <span class="n">block</span><span class="p">[</span><span class="n">block_keys0</span><span class="p">]</span>
                <span class="k">break</span>
        <span class="k">return</span> <span class="n">block_data</span>

    <span class="k">def</span> <span class="nf">_load</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># first flatten the dict</span>
        <span class="n">block_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flatten_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parsed_data</span><span class="p">)</span>
        <span class="c1"># load file designations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load_designation</span><span class="p">(</span><span class="n">block_data</span><span class="p">[</span><span class="s1">&#39;designation&#39;</span><span class="p">])</span>
        <span class="c1"># load parameters</span>
        <span class="k">if</span> <span class="s1">&#39;parameters&#39;</span> <span class="ow">in</span> <span class="n">block_data</span><span class="p">:</span>
            <span class="n">_parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_parameters</span><span class="p">(</span><span class="n">block_data</span><span class="p">[</span><span class="s1">&#39;parameters&#39;</span><span class="p">],</span> <span class="s1">&#39;Parameters&#39;</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># just create an empty parameters block to keep header consistent</span>
            <span class="n">_parameters</span> <span class="o">=</span> <span class="n">Block</span><span class="p">(</span><span class="s1">&#39;Parameters&#39;</span><span class="p">)</span>
        <span class="c1"># if we have a Materials block in parameters we create a convenience dictionary for</span>
        <span class="c1"># accessing materials e.g. for patches</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">_parameters</span><span class="p">,</span> <span class="s1">&#39;Materials&#39;</span><span class="p">):</span>
            <span class="n">material_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">material</span> <span class="ow">in</span> <span class="n">_parameters</span><span class="o">.</span><span class="n">Materials</span><span class="p">:</span>
                <span class="n">material_dict</span><span class="p">[</span><span class="n">material</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">material</span>
            <span class="n">_parameters</span><span class="o">.</span><span class="n">Materials</span><span class="o">.</span><span class="n">material_dict</span> <span class="o">=</span> <span class="n">material_dict</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">AmiraHeader</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">add_attr</span><span class="p">(</span><span class="s1">&#39;Parameters&#39;</span><span class="p">,</span> <span class="n">_parameters</span><span class="p">)</span>
        <span class="c1"># load array declarations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load_declarations</span><span class="p">(</span><span class="n">block_data</span><span class="p">[</span><span class="s1">&#39;array_declarations&#39;</span><span class="p">])</span>
        <span class="c1"># load data stream definitions</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filetype</span> <span class="o">==</span> <span class="s2">&quot;AmiraMesh&quot;</span><span class="p">:</span>
            <span class="c1"># a list of data streams</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data_streams_block_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_definitions</span><span class="p">(</span><span class="n">block_data</span><span class="p">[</span><span class="s1">&#39;data_definitions&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data_stream_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_streams_block_list</span><span class="p">)</span>
            <span class="c1"># if self.load_streams:</span>
            <span class="c1">#     for ds in data_streams_list:</span>
            <span class="c1">#         ds.read()</span>
            <span class="c1">#         ds.add_attr(&#39;data&#39;, ds.data())</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">filetype</span> <span class="o">==</span> <span class="s2">&quot;HyperSurface&quot;</span><span class="p">:</span>
            <span class="c1"># data_streams_list = self._locate_hx_streams()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data_streams_block_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data_stream_count</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_streams</span><span class="p">:</span>
                <span class="n">block</span> <span class="o">=</span> <span class="n">set_data_stream</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
                <span class="n">block</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="c1"># self.add_attr(block)</span>

    <span class="c1"># @property</span>
    <span class="c1"># def Parameters(self):</span>
    <span class="c1">#     return self._parameters</span>

<div class="viewcode-block" id="AmiraHeader.designation"><a class="viewcode-back" href="../../ahds.html#ahds.AmiraHeader.designation">[docs]</a>    <span class="nd">@deprecated</span><span class="p">(</span><span class="s2">&quot; use header attributes version, dimension, fileformat, format and extra_format istead&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">designation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Designation of the Amira file defined in the first row</span>
<span class="sd">        </span>
<span class="sd">        Designations consist of some or all of the following data:</span>
<span class="sd">        </span>
<span class="sd">        *    filetype e.g. ``AmiraMesh`` or ``HyperSurface``</span>
<span class="sd">        </span>
<span class="sd">        *    dimensions e.g. ``3D``</span>
<span class="sd">        </span>
<span class="sd">        *    format e.g. ``BINARY-LITTLE-ENDIAN``</span>
<span class="sd">        </span>
<span class="sd">        *    version e.g. ``2.1``</span>
<span class="sd">        </span>
<span class="sd">        *    extra format e.g. ``&lt;hxsurface&gt;``</span>

<span class="sd">        NOTE: this property is deprecated use the corresponding attributes of the AmiraHeader</span>
<span class="sd">        instead to access the above informations</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="AmiraHeader.definitions"><a class="viewcode-back" href="../../ahds.html#ahds.AmiraHeader.definitions">[docs]</a>    <span class="nd">@deprecated</span><span class="p">(</span><span class="s2">&quot; use data array attributes instead eg. Vertices, Triangles, ...&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">definitions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Definitions consist of a key-value pair specified just after the </span>
<span class="sd">        designation preceded by the key-word &#39;define&#39;      </span>

<span class="sd">        NOTE: this property is deprecated access the corresponding attributes directly</span>
<span class="sd">        eg. ah.Nodes instead of ah.definitions.Nodes or ah.Tetrahedra instead of ah.defintions.Tetrahedra</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="AmiraHeader.data_pointers"><a class="viewcode-back" href="../../ahds.html#ahds.AmiraHeader.data_pointers">[docs]</a>    <span class="nd">@deprecated</span><span class="p">(</span><span class="s2">&quot; use data attributes of data arrays  instead eg. header.Vertices.Coordinates&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">data_pointers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The list of data pointers together with a name, data type, dimension, </span>
<span class="sd">        index, format and length</span>

<span class="sd">        NOTE: deprecated access the data defnitions for each data array through the corresponding attributes</span>
<span class="sd">        eg.: ah.Nodes.Coordinates instead of ah.data_pointers.data_pointer_1 ah.Tetrahedra.Nodes instead of </span>
<span class="sd">        ah.data_pointers.data_pointer_2 etc.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">_data_pointers</span> <span class="o">=</span> <span class="n">Block</span><span class="p">(</span><span class="s2">&quot;data_pointers&quot;</span><span class="p">)</span>
        <span class="c1"># _i = 0</span>
        <span class="c1"># for _idx, _data in _dict_iter_items(self._field_data_map):</span>
        <span class="c1">#     _data_pointers.add_attr(&quot;data_pointer_{}&quot;.format(_i), _data)</span>
        <span class="c1">#     _i += 1</span>
        <span class="k">return</span> <span class="n">_data_pointers</span></div>

    <span class="k">def</span> <span class="nf">_load_designation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block_data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_attr</span><span class="p">(</span><span class="s1">&#39;filetype&#39;</span><span class="p">,</span> <span class="n">block_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;filetype&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_attr</span><span class="p">(</span><span class="s1">&#39;dimension&#39;</span><span class="p">,</span> <span class="n">block_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dimension&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="nb">format</span> <span class="o">=</span> <span class="n">block_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;format&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;BINARY&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_attr</span><span class="p">(</span><span class="s1">&#39;format&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_attr</span><span class="p">(</span><span class="s1">&#39;endian&#39;</span><span class="p">,</span> <span class="s1">&#39;BIG&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;ASCII&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_attr</span><span class="p">(</span><span class="s1">&#39;format&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_attr</span><span class="p">(</span><span class="s1">&#39;endian&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;BINARY-LITTLE-ENDIAN&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_attr</span><span class="p">(</span><span class="s1">&#39;format&#39;</span><span class="p">,</span> <span class="s1">&#39;BINARY&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_attr</span><span class="p">(</span><span class="s1">&#39;endian&#39;</span><span class="p">,</span> <span class="s1">&#39;LITTLE&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">u</span><span class="s1">&#39;unsupported format </span><span class="si">{format}</span><span class="s1">; kindly consider contacting the maintainer to include support. Thanks.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">))</span>
        <span class="c1"># self.add_attr(&#39;format&#39;, block_data.get(&#39;format&#39;, None))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_attr</span><span class="p">(</span><span class="s1">&#39;version&#39;</span><span class="p">,</span> <span class="n">block_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;version&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_attr</span><span class="p">(</span><span class="s1">&#39;extra_format&#39;</span><span class="p">,</span> <span class="n">block_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;extra_format&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_load_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block_data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Parameters&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># treat materials specially (and possibly others in the future)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Materials&quot;</span><span class="p">]:</span>
            <span class="n">block</span> <span class="o">=</span> <span class="n">ListBlock</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">block_data</span><span class="p">:</span>
                <span class="c1"># a sequence of parameters</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;parameter_value&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;parameter_value&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;parameter_value&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&lt;!?c?!&gt;&#39;</span><span class="p">:</span>
                            <span class="n">block</span><span class="o">.</span><span class="n">add_attr</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;parameter_name&#39;</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;parameter_value&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">block</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_load_parameters</span><span class="p">(</span>
                                    <span class="n">param</span><span class="p">[</span><span class="s1">&#39;parameter_value&#39;</span><span class="p">],</span>
                                    <span class="n">name</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;parameter_name&#39;</span><span class="p">]</span>
                                <span class="p">)</span>
                            <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">block</span><span class="o">.</span><span class="n">add_attr</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;parameter_name&#39;</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;parameter_value&#39;</span><span class="p">])</span>
                <span class="c1"># a string or number</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">block</span><span class="o">.</span><span class="n">add_attr</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;parameter_name&#39;</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;parameter_value&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">block</span> <span class="o">=</span> <span class="n">Block</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">block_data</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;parameter_value&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;parameter_value&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;parameter_value&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&lt;!?c?!&gt;&#39;</span><span class="p">:</span>
                                <span class="n">block</span><span class="o">.</span><span class="n">add_attr</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;parameter_name&#39;</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;parameter_value&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:])</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">block</span><span class="o">.</span><span class="n">add_attr</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">_load_parameters</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;parameter_value&#39;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;parameter_name&#39;</span><span class="p">]))</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;parameter_name&#39;</span><span class="p">],</span> <span class="nb">type</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;parameter_name&#39;</span><span class="p">]))</span>
                            <span class="n">block</span><span class="o">.</span><span class="n">add_attr</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;parameter_name&#39;</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;parameter_value&#39;</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">block</span><span class="o">.</span><span class="n">add_attr</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;parameter_name&#39;</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;parameter_value&#39;</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;Found odd parameter: </span><span class="si">{}</span><span class="s2"> = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]]),</span>
                          <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">block</span>

    <span class="k">def</span> <span class="nf">_load_declarations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load the array definition blocks which will contain the data streams&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">decl</span> <span class="ow">in</span> <span class="n">block_data</span><span class="p">:</span>
            <span class="n">block</span> <span class="o">=</span> <span class="n">Block</span><span class="p">(</span><span class="n">decl</span><span class="p">[</span><span class="s1">&#39;array_name&#39;</span><span class="p">])</span>
            <span class="n">block</span><span class="o">.</span><span class="n">add_attr</span><span class="p">(</span><span class="s1">&#39;length&#39;</span><span class="p">,</span> <span class="n">decl</span><span class="p">[</span><span class="s1">&#39;array_dimension&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_attr</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_load_definitions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;We want to load data definitions to the appropriate array definition block&quot;&quot;&quot;</span>
        <span class="n">data_streams</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">data_stream_indices</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">defn</span> <span class="ow">in</span> <span class="n">block_data</span><span class="p">:</span>
            <span class="c1"># check whether the array_ref is an attribute on self</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">parent</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">defn</span><span class="p">[</span><span class="s1">&#39;array_reference&#39;</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span>
            <span class="c1"># set the data streams</span>
            <span class="n">block</span> <span class="o">=</span> <span class="n">set_data_stream</span><span class="p">(</span><span class="n">defn</span><span class="p">[</span><span class="s1">&#39;data_name&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="p">)</span>
            <span class="n">block</span><span class="o">.</span><span class="n">add_attr</span><span class="p">(</span><span class="s1">&#39;data_index&#39;</span><span class="p">,</span> <span class="n">defn</span><span class="p">[</span><span class="s1">&#39;data_index&#39;</span><span class="p">])</span>
            <span class="c1"># conditionally add the data stream if its index is unique e.g. Fields do not have unique ds</span>
            <span class="k">if</span> <span class="n">defn</span><span class="p">[</span><span class="s1">&#39;data_index&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data_stream_indices</span><span class="p">:</span>
                <span class="n">data_streams</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
            <span class="c1"># keep track of the data stream indices</span>
            <span class="n">data_stream_indices</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">defn</span><span class="p">[</span><span class="s1">&#39;data_index&#39;</span><span class="p">])</span>
            <span class="n">block</span><span class="o">.</span><span class="n">add_attr</span><span class="p">(</span><span class="s1">&#39;dimension&#39;</span><span class="p">,</span> <span class="n">defn</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data_dimension&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>  <span class="c1"># assume dimension of 1</span>
            <span class="n">block</span><span class="o">.</span><span class="n">add_attr</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="n">defn</span><span class="p">[</span><span class="s1">&#39;data_type&#39;</span><span class="p">])</span>
            <span class="n">block</span><span class="o">.</span><span class="n">add_attr</span><span class="p">(</span><span class="s1">&#39;interpolation_method&#39;</span><span class="p">,</span> <span class="n">defn</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;interpolation_method&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">block</span><span class="o">.</span><span class="n">add_attr</span><span class="p">(</span><span class="s1">&#39;shape&#39;</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="s1">&#39;length&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">block</span><span class="o">.</span><span class="n">add_attr</span><span class="p">(</span><span class="s1">&#39;format&#39;</span><span class="p">,</span> <span class="n">defn</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data_format&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
            <span class="c1"># insert this definition as an attribute</span>
            <span class="c1"># parent.add_attr(block)</span>
            <span class="c1"># keep track of data streams</span>
        <span class="k">return</span> <span class="n">data_streams</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;AmiraHeader(&#39;</span><span class="si">{}</span><span class="s2">&#39;)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span></div>

    <span class="c1"># def __str__(self, prefix=&quot;&quot;, index=None):</span>
    <span class="c1">#     width = 140</span>
    <span class="c1">#     string = &#39;&#39;</span>
    <span class="c1"># string += &#39;*&#39; * width + &#39;\n&#39;</span>
    <span class="c1"># string += &quot;AMIRA HEADER \n&quot;</span>
    <span class="c1"># string += &quot;-&quot; * width + &quot;\n&quot;</span>
    <span class="c1"># string += &quot;+-file: {}\n&quot;.format(self.filename)</span>
    <span class="c1"># string += &quot;+-header length: {}\n&quot;.format(len(self))</span>
    <span class="c1"># string += &quot;+-data streams: {}\n&quot;.format(self.data_stream_count)</span>
    <span class="c1"># string += &quot;+-streams loaded? {}\n&quot;.format(str(self.load_streams))</span>
    <span class="c1"># string += &quot;-&quot; * width + &quot;\n&quot;</span>
    <span class="c1"># string += &quot;{}&quot;.format(self.parameters)</span>
    <span class="c1"># string += &quot;-&quot; * width + &quot;\n&quot;</span>
    <span class="c1"># string += super(AmiraHeader, self).__str__()</span>
    <span class="c1"># string += &quot;*&quot; * width</span>
    <span class="c1"># return string</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;usage: ./</span><span class="si">{}</span><span class="s2"> &lt;amira-fn&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span>

    <span class="n">h</span> <span class="o">=</span> <span class="n">AmiraHeader</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">designation</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">h</span><span class="o">.</span><span class="n">parameters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">attrs</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span> <span class="s2">&quot;Materials&quot;</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">Materials</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">Materials</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">Materials</span><span class="o">.</span><span class="n">attrs</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">Materials</span><span class="o">.</span><span class="n">Exterior</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">Materials</span><span class="o">.</span><span class="n">ids</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">Materials</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">id_</span> <span class="ow">in</span> <span class="n">h</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">Materials</span><span class="o">.</span><span class="n">ids</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">Materials</span><span class="p">[</span><span class="n">id_</span><span class="p">])</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">designation</span><span class="p">)</span>
    <span class="c1"># pylint: disable=E1101</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">data_pointers</span><span class="o">.</span><span class="n">attrs</span><span class="p">)</span>
    <span class="c1"># pylint: enable=E1101</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="s2">&quot;Lattice&quot;</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">Lattice</span><span class="o">.</span><span class="n">Data</span><span class="p">)</span>

    <span class="k">return</span> <span class="mi">0</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, EMBL-EBI

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>